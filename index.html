<!doctype html>
<html>
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0"/>
<title>YAS</title>
<link rel="shortcut icon" href="/favicon.ico"/>
<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.jpg">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<style>
	td {
		white-space: nowrap;
	}
</style>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/0.9.1/hls.min.js"></script>
<script copy="1" src="/js/galaxymimi.js"></script>
<div class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<a class="navbar-brand" href="#">
				YAS
			</a>
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navBar">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
		</div>
		<div class="collapse navbar-collapse navbar-right" id="navBar">
			<ul class="nav navbar-nav">
				<li><a href="/" target="_blank">首页</a></li>
				<li><a href="https://www.heavens-above.com" target="_blank">来源</a></li>
				<li class="dropdown" id="drop">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">手机浏览 <span class="caret"></span></a>
					<ul class="dropdown-menu" aria-labelledby="dropdown">
						<li><a href="javascript:void(0)">扫码打开本页面</a></li>
						<li>
							<img id="qrcode" style="width: 100%"/>
							<script>
								if (/mobile/i.test(navigator.userAgent) || /mobile/i.test(navigator.appVersion)) $("#drop").hide(); //window.hasOwnProperty("ontouchstart")
								$("#qrcode").attr("src", "/api/qrcode?margin=1&text=" + location.href);
							</script>
						</li>
					</ul>
				</li>
			</ul>
		</div>
	</div>
</div>
<div class="container">
	<h1>国际空间站（ISS）过境</h1>
</div>
<div class="container" style="overflow-x: scroll;">
	<table class="table table-striped table-bordered">
		<thead>
			<tr>
				<td align="center" rowspan="2" style="vertical-align:middle">
					推荐度
				</td>
				<td align="center" rowspan="2" style="vertical-align:middle">
					日期
				</td>
				<td align="center" rowspan="2" style="vertical-align:middle">
					持续时间
				</td>
				<td align="center" rowspan="2" style="vertical-align:middle">
					星等
				</td>
				<td align="center" rowspan="2" style="vertical-align:middle">
					星图
				</td>
				<td align="center" colspan="6">
					升
				</td>
				<td align="center" colspan="6">
					到达高度10°
				</td>
				<td align="center" colspan="6">
					上中天
				</td>
				<td align="center" colspan="6">
					低于高度10°
				</td>
				<td align="center" colspan="6">
					降
				</td>
				<td align="center" colspan="6">
					离开地影
				</td>
				<td align="center" colspan="6">
					进入地影
				</td>
			</tr>
			<tr class="tr">
			</tr>
		</thead>
		<tbody id="ISS">
		</tbody>
	</table>
</div>

<div class="container">
	<h1>天宫二号过境</h1>
</div>
<div class="container" style="overflow-x: scroll;">
	<table class="table table-striped table-bordered">
		<thead>
			<tr>
				<td align="center" rowspan="2" style="vertical-align:middle">
					推荐度
				</td>
				<td align="center" rowspan="2" style="vertical-align:middle">
					日期
				</td>
				<td align="center" rowspan="2" style="vertical-align:middle">
					持续时间
				</td>
				<td align="center" rowspan="2" style="vertical-align:middle">
					星等
				</td>
				<td align="center" rowspan="2" style="vertical-align:middle">
					星图
				</td>
				<td align="center" colspan="6">
					升
				</td>
				<td align="center" colspan="6">
					到达高度10°
				</td>
				<td align="center" colspan="6">
					上中天
				</td>
				<td align="center" colspan="6">
					低于高度10°
				</td>
				<td align="center" colspan="6">
					降
				</td>
				<td align="center" colspan="6">
					离开地影
				</td>
				<td align="center" colspan="6">
					进入地影
				</td>
			</tr>
			<tr class="tr">
			</tr>
		</thead>
		<tbody id="TianGong">
		</tbody>
	</table>
</div>

<div class="container">
	<h1>铱星闪光</h1>
</div>
<div class="container" style="overflow-x: scroll;">
	<table class="table table-striped table-bordered">
		<thead>
			<tr>
				<td align="center" rowspan="2" style="vertical-align:middle">
					推荐度
				</td>
				<td align="center" rowspan="2" style="vertical-align:middle">
					日期
				</td>
				<td align="center" rowspan="2" style="vertical-align:middle">
					持续时间
				</td>
				<td align="center" rowspan="2" style="vertical-align:middle">
					星等
				</td>
				<td align="center" rowspan="2" style="vertical-align:middle">
					星图
				</td>
				<td align="center" colspan="6">
					升
				</td>
				<td align="center" colspan="6">
					到达高度10°
				</td>
				<td align="center" colspan="6">
					上中天
				</td>
				<td align="center" colspan="6">
					低于高度10°
				</td>
				<td align="center" colspan="6">
					降
				</td>
				<td align="center" colspan="6">
					离开地影
				</td>
				<td align="center" colspan="6">
					进入地影
				</td>
			</tr>
			<tr class="tr">
			</tr>
		</thead>
		<tbody id="TianGong">
		</tbody>
	</table>
</div>
<script>
var names = ["ISS", "TianGong", "IridiumFlares"];
var property = ["url", "date", "brightness", "events", "passType", "image", "scoreData", "exist", "score"];
var events = ["rise", "reachAltitude10deg", "highestPoint", "dropBelowAltitude10deg", "set", "exitShadow", "enterShadow"];
var attribute = ["time", "altitude", "azimuth", "distance", "brightness", "sunAltitude"];
var eventsIridium = ["url", "brightness", "altitude", "azimuth", "satellite", "distanceToFlareCentre", "brightnessAtFlareCentre", "date", "time", "distanceToSatellite", "AngleOffFlareCentre-line", "flareProducingAntenna", "sunAltitude", "angularSeparationFromSun", "image"];

function appendThead() {
	$(".tr").append('\
				<td align="center">\
					时间\
				</td>\
				<td align="center">\
					高度角\
				</td>\
				<td align="center">\
					方位角\
				</td>\
				<td align="center">\
					距离\
				</td>\
				<td align="center">\
					星等\
				</td>\
				<td align="center">\
					太阳高度\
				</td>');
}

function showData(target) {
	var file = target + ".json";
	$.ajax(file, {
		type: "get",
		dataType: "text",
		error: function(xhr, status, error) {
			console.log("Error");
		},
		success: function(data, status, xhr) {
			var obj = JSON.parse(data);
			obj.forEach(function(ele, index) {
				var html = "<td>" + ele[property[8]] + "</td><td>" + ele[property[1]] + "</td><td>" + ele[property[7]] + "</td><td>" + ele[property[2]] + "</td><td><a href='" + ele[property[0]] + "' target='_blank'>查看</a></td>";
				for (var j = 0; j < 7; j++) {
					if (ele[property[3]][events[j]]) {
						for (var k in ele[property[3]][events[j]]) {
							html += "<td>" + ele[property[3]][events[j]][k] + "</td>";
						}
					}
					else {
						for (var k = 0; k < 6; k++) {
							html += "<td>N/A</td>";
						}
					}
				}
				if (index <= 3) $("#" + target).append("<tr style='background-color:rgb(0,200,50)'>" + html + "</tr>");
				else if (ele[property[8]] == 0) $("#" + target).append("<tr style='background-color:rgb(200,100,50)'>" + html + "</tr>");
				else $("#" + target).append("<tr>" + html + "</tr>");
			});
		}
	});
}

for (var i = 0; i < 7; i++) appendThead();
showData("ISS");
showData("TianGong");
</script>
</body>
</html>
